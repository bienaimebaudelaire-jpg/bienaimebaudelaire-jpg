<!doctype html>
<html lang='fr'>
<head>
<meta charset='utf-8' />
<meta name='viewport' content='width=device-width,initial-scale=1' />
<title>HUMEAN Chat</title>
<style>
  body{font-family:Inter,system-ui,Arial;margin:0;padding:18px;background:#f6f8fa}
  #app{max-width:900px;margin:0 auto}
  header{display:flex;gap:12px;align-items:center}
  .box{background:#fff;border-radius:8px;padding:12px;box-shadow:0 1px 2px rgba(0,0,0,.06)}
  #messages{min-height:300px;margin-top:12px;padding:12px;overflow:auto}
  .msg{margin:8px 0;padding:10px;border-radius:8px}
  .user{background:#e6f7ff;text-align:right}
  .bot{background:#f1f3f5;text-align:left}
  #composer{display:flex;gap:8px;margin-top:12px}
  #prompt{flex:1;padding:10px;border:1px solid #ddd;border-radius:6px}
  button{padding:10px 14px;border-radius:6px;border:0;background:#2563eb;color:#fff;cursor:pointer}
  small{color:#666}
</style>
</head>
<body>
<div id="app" class="box">
  <header><h2>HUMEAN — Chat</h2><small>Backend: <span id="backend">127.0.0.1:5000</span></small></header>
  <div id="messages" class="box" aria-live="polite"></div>
  <div id="composer">
    <input id="prompt" placeholder="Écris ta question ici..." autocomplete="off" />
    <button id="send">Envoyer</button>
  </div>
</div>
<script>
const messagesEl = document.getElementById('messages');
const promptEl = document.getElementById('prompt');
const sendBtn = document.getElementById('send');
function addMessage(text, who='bot'){
  const div = document.createElement('div');
  div.className = 'msg ' + (who==='user'? 'user':'bot');
  div.textContent = text;
  messagesEl.appendChild(div);
  messagesEl.scrollTop = messagesEl.scrollHeight;
}
async function sendPrompt(){
  const text = promptEl.value.trim();
  if(!text) return;
  addMessage(text,'user');
  promptEl.value = '';
  sendBtn.disabled = true;
  try {
    const res = await fetch('/api/query', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({ user_id: 'local', prompt: text, meta: { type: 'general' } })
    });
    const j = await res.json();
    const reply = j.response || JSON.stringify(j);
    addMessage(typeof reply === 'string' ? reply : JSON.stringify(reply, null, 2));
  } catch(e){
    addMessage('Erreur réseau ou backend: ' + e.message);
  } finally {
    sendBtn.disabled = false;
  }
}
sendBtn.addEventListener('click', sendPrompt);
promptEl.addEventListener('keydown', (e)=>{ if(e.key==='Enter') sendPrompt(); });
</script>
</body>
</html>
